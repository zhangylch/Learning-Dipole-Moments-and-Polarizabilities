# Learning-Dipole-Moments-and-Polarizabilities
## 1. Introcuction:
Embedded atom neural network (EANN) is a python package implemented based on the PyTorch framework used to train interatomic potentials, dipole moments, transition dipole moments and polarizabilities of various systems. This project is still under active development. The current version only includes a serializable model saved in the folder named potentials  generated by the TorchScript compiler used to predict the permanent dipole moment, transition dipole moment and polarizability of N-methylacetamide (NMA) molecules. These models were trained based on 10000 NMA configurations exacted from 1000 different protein backbones at room temperature from the Protein Data Bank (PDB). The unit of the coordinates is angstrom and the unit of molecular properties is the atomic unit. The permanent dipole moment and polarizability were calculated by density functional theory (DFT) at the B3LYP/cc-pVDZ level. The perpendicular nπ* and parallel ππ* transition dipole moments were calculated by time-dependent density functional theory (TDDFT) at the B3LYP/cc-pVDZ level. The full package will be released soon.  
## 2. Employ the model:
These serializable models were generated using TorchScript embedded in PyTorch. In order to use these models, the pytorch (or libtorch in c++ production) is required. Below is an example script for predicting the permanent dipole moment.
```python
import numpy as np
import torch
# gpu/cpu
device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
# same as the atomtype in the file input_density
atomtype=["C","O","N","H"]
mass=[12.001,15.999,14.007,1.008]
mass=torch.from_numpy(np.array(mass))
#load the serilizable model
pes=torch.jit.load("EANN_DM_DOUBLE.pt")
pes.eval()
pes.to(device).to(torch.double)
pes=torch.jit.freeze(pes,optimize_numerics=True)
# set the eval mode
# save the lattice parameters
cell=np.zeros((3,3),dtype=np.float64)
period_table=torch.tensor([0,0,0],dtype=torch.double,device=device)   # same as the pbc in the periodic boundary condition
npoint=0
npoint1=0
rmse=torch.zeros(1,dtype=torch.double,device=device)
cart=[]
#read the data
with open("configuration",'r') as f1:
    while True:
        string=f1.readline()
        if not string or npoint==1000: break
        string=f1.readline()
        cell[0]=np.array(list(map(float,string.split())))
        string=f1.readline()
        cell[1]=np.array(list(map(float,string.split())))
        string=f1.readline()
        cell[2]=np.array(list(map(float,string.split())))
        string=f1.readline()
        species=[]
        cart.append([])
        while True:
            string=f1.readline()
            if "abprop" in string: break
            tmp=string.split()
            tmp1=list(map(float,tmp[2:8]))
            cart[npoint].append(tmp1[0:3])
            species.append(atomtype.index(tmp[0]))
        abini=list(map(float,string.split()[1:4]))
        abini=torch.from_numpy(np.array(abini)).to(device)
        species=torch.from_numpy(np.array(species)).to(device)  # from numpy array to torch tensor
        tcell=torch.from_numpy(cell).to(device).to(torch.double)  
        tmass=mass.index_select(0,species)
        npoint+=1
cart=torch.from_numpy(np.array(cart)).to(device).to(torch.double) 
for i in range(1000):
    var,=pes(period_table,cart[i],tcell,species,tmass)
```
## 3. References:
The EANN model for dipole/transition dipole/polarizability: Yaolong Zhang,  Sheng Ye, Jinxiao Zhang, Jun Jiang and Bin Jiang<sup>*</sup> *J. Phys. Chem. B* [link](https://pubs.acs.org/doi/10.1021/acs.jpcb.0c06926?goto=articleMetrics&ref=pdf)
